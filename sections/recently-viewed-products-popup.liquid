{%- style -%}
  #shopify-section-{{ section.id }} {
    --progress-bar-color: 255, 255, 255;
    --section-autoplay-duration: 3s;
    --section-animation-play-state: paused;
    display: none;
  }
  #shopify-section-{{ section.id }}.active{
    display: block;
  }
  {%- for product in predictive_search.resources.products -%}
    #ap-productsviewed-button-{{ forloop.index }} {
      --section-blocks-alignment: center;
      --section-blocks-overlay-opacity: 0.05;
    }
  {% endfor %}
  ap-productsslideshowitem {
    cursor: pointer;
  }
  #products-viewed-popup {
    display: block;
    position: fixed;
    bottom: calc(3vh + 60px);
    left: 2vh;
    text-align: center;
    border: 1px solid;
    border-radius: 50%;
    height: 100px;
    width: 100px;
    overflow: hidden;
    z-index: 9;
  }
  .recently-list {
    display: grid;
    gap: 20px;
    grid-template-columns: 1fr 1fr;
  }
  .recently-list .product-item-wrapper {
    padding: 0;
  }
  ap-recentlyproductsviewed-popup .drawer__content {
    padding: 20px;
  }
  .recently-list .product-item__image-wrapper {
    max-width: 300px;
    min-width: 200px;
  }
  #shopify-section-{{ section.id }} .product-item-meta ,
  .recently-list .slider__item {
    padding: 0;
  }
  .recently-list .service-add-cart {
    display: none;
    padding-left: 0;
    padding-right: 0;
    position: unset;
    transform: none!important;
    opacity: 1;
    visibility: visible;
    width: 100%;
    margin-top: 30px;
  }
  .recently-list .product-item__info {
    border-top: none;
    padding: 20px;
    width: 100%;
  }
  .recently-list .product-item-wrapper:hover .product-item__info {
    transform: none;
  }
  .recently-list .service-product ,
  .recently-list .jdgm-widget.jdgm-widget {
    display: none;
  }
  ap-recentlyproductsviewed-popup .heading.h1 {
    font-size: 24px;
    line-height: 1;
  }
  @media (max-width: 576px) {
    .recently-list .product-item__image-wrapper {
      max-width: 100%;
    }
    ap-recentlyproductsviewed-popup .heading.h1 {
      font-size: 18px;
    }
    .recently-list {
      grid-template-columns: 1fr;
    }
  }
{%- endstyle -%}

{{ 'recently-viewed.css' | asset_url | stylesheet_tag }}

<ap-productsviewed-button>
  <div id="products-viewed-popup">
    <a style="display:block" href="#" is="ap-togglelink" ap-controlsaria="{{ section.id }}" ap-expanded-aria="false" data-no-instant="">
      <ap-productsslideshow reveal-on-scroll="" auto-play="true" transition-type="fade" class="slideshow {{ section.settings.slideshow_height }} ap-object-loaded" style="">
        <div class="slideshow__slide-list">
          {%- for product in predictive_search.resources.products -%}
            <ap-productsslideshowitem id="ap-productsviewed-button-{{ forloop.index }}" ap-revealvisibility="" class="slideshow__slide slideshow__slide--fade" style="visibility: visible;" {% if forloop.index > 1 %}hidden=""{% endif %}>
              <img class="product-item__primary-image" loading="eager" data-media-id="{{ product.featured_media.id }}" 
                sizes= "{{ product.featured_image }}px"
                alt="{{ product.title }}" 
                src="{{ product.featured_image | image_url: width: 200 }}" 
                srcset="
                    {%- if product.featured_media.width >= 165 -%}{{ product.featured_media | image_url: width: 165 }} 165w,{%- endif -%}
                    {%- if product.featured_media.width >= 360 -%}{{ product.featured_media | image_url: width: 360 }} 360w,{%- endif -%}
                "
                width="200" height="200">
            </ap-productsslideshowitem>
          {% endfor %}
        </div>
  
        <ap-pagedots animation-timer="" class="slideshow__nav container">
          {%- for product in predictive_search.resources.products -%}
            <button class="slideshow__progress-bar" ap-controlsaria="ap-productsviewed-button-{{ forloop.index }}" ap-currentaria="{% if forloop.index == 1 %}true{% else %}false{% endif %}">
                <span class="visually-hidden">{{ forloop.index }}</span>
              </button>
          {%- endfor -%}
        </ap-pagedots>
  
      </ap-productsslideshow>  
    </a>
  </div>
</ap-productsviewed-button>
<ap-recentlyproductsviewed-popup id="{{ section.id }}" section="{{ section.id }}" section-id="{{ section.id }}" products-count="{{ section.settings.products_to_show }}" class="section section--flush drawer drawer--large">
    <span class="drawer__overlay"></span>
    <header class="drawer__header">
      <p class="drawer__title heading h{{ section.settings.heading_size }}">{{ section.settings.heading | escape }}</p>
      <button type="button" class="drawer__close-button tap-area" data-action="close" title="Close"><svg focusable="false" width="14" height="14" class="icon icon--close   " viewBox="0 0 14 14">
        <path d="M13 13L1 1M13 1L1 13" stroke="currentColor" stroke-width="2" fill="none"></path>
      </svg></button>
    </header>

    <div class="drawer__content drawer__content--padded-start">
      <div class="recently-list">
        {%- for product in predictive_search.resources.products -%}
            {% render 'product-grid', product: product %}
        {% endfor %}
      </div>
    </div>
</ap-recentlyproductsviewed-popup>
       
{% schema %}
{
  "name": "Recently viewed popup",
  "tag": "section",
  "class": "shopify-section--recently-viewed-products-popup",
  "settings": [
    {
      "type": "paragraph",
      "content": "Setting Recently viewed products"
    },
    {
      "type": "text",
      "id": "heading",
      "default": "Recently viewed products",
      "label": "Heading"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 1,
      "label": "Heading size"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 10,
      "step": 1,
      "default": 10,
      "label": "Show product"
    }
  ]
}
{% endschema %}